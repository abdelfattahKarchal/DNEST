@extends('layouts.app')
@section('content')
    <!-- Begin Blog Details Right Sidebar Area -->
    <div class="hiraola-blog_area hiraola-blog_area-2 hiraola-blog-details hiraola-banner_area">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 order-lg-2 order-2">
                    <div class="hiraola-blog-sidebar-wrapper">
                        <div class="hiraola-blog-sidebar">
                            <h4 class="hiraola-blog-sidebar-title">Recent Post</h4>
                            <div class="hiraola-recent-post">
                                <div class="hiraola-recent-post-thumb">
                                    <a href="blog-details-left-sidebar.html">
                                        <img class="img-full"
                                            src="{{ asset('front/assets/images/product/small-size/2-1.jpg') }}"
                                            alt="Hiraola's Product Image">
                                    </a>
                                </div>
                                <div class="hiraola-recent-post-des">
                                    <span><a href="blog-details-left-sidebar.html">First Blog Post</a></span>
                                    <span class="hiraola-post-date">28-05-19</span>
                                </div>
                            </div>
                            <div class="hiraola-recent-post">
                                <div class="hiraola-recent-post-thumb">
                                    <a href="blog-details-left-sidebar.html">
                                        <img class="img-full"
                                            src="{{ asset('front/assets/images/product/small-size/2-2.jpg') }}"
                                            alt="Hiraola's Product Image">
                                    </a>
                                </div>
                                <div class="hiraola-recent-post-des">
                                    <span><a href="blog-details-left-sidebar.html">Second Blog Post</a></span>
                                    <span class="hiraola-post-date">28-05-19</span>
                                </div>
                            </div>
                            <div class="hiraola-recent-post">
                                <div class="hiraola-recent-post-thumb">
                                    <a href="blog-details-left-sidebar.html">
                                        <img class="img-full"
                                            src="{{ asset('front/assets/images/product/small-size/2-3.jpg') }}"
                                            alt="Hiraola's Product Image">
                                    </a>
                                </div>
                                <div class="hiraola-recent-post-des">
                                    <span><a href="blog-details-left-sidebar.html">Third Blog Post</a></span>
                                    <span class="hiraola-post-date">28-05-19</span>
                                </div>
                            </div>
                        </div>
                        <div class="hiraola-sidebar-catagories_area">

                            <div class="category-module hiraola-sidebar_categories">
                                <div class="category-module_heading">
                                    <h5>Collections</h5>
                                </div>
                                <div class="module-body">
                                    <ul class="module-list_item">
                                        <li>
                                            <a href="javascript:void(0)" class="text-uppercase font-weight-bold">SAHARA (18)
                                            </a>
                                            <ul class="module-sub-list_item">
                                                <li>
                                                    <a href="javascript:void(0)"
                                                        class="text-capitalize font-weight-bold">bagues (18)</a>
                                                    <ul class="module-sub-list_item">
                                                        <li>
                                                            <a href="javascript:void(0)">Hommes(18)</a>
                                                            <a href="javascript:void(0)">Femmes(18)</a>
                                                        </li>
                                                    </ul>
                                                    <a href="javascript:void(0)"
                                                        class="text-capitalize font-weight-bold">Colliers (18)</a>
                                                    <ul class="module-sub-list_item">
                                                        <li>
                                                            <a href="javascript:void(0)">Hommes(18)</a>
                                                            <a href="javascript:void(0)">Femmes(18)</a>
                                                        </li>
                                                    </ul>
                                                    <a href="javascript:void(0)"
                                                        class="text-capitalize font-weight-bold">Bracelés (18)</a>
                                                    <ul class="module-sub-list_item">
                                                        <li>
                                                            <a href="javascript:void(0)">Hommes(18)</a>
                                                            <a href="javascript:void(0)">Femmes(18)</a>
                                                        </li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </li>

                                        <li>
                                            <a href="javascript:void(0)" class="text-uppercase font-weight-bold">BERBER
                                                (100)</a>
                                            <ul class="module-sub-list_item">
                                                <li>
                                                    <a href="javascript:void(0)"
                                                        class="text-capitalize font-weight-bold">Bagues (18)</a>
                                                    <ul class="module-sub-list_item">
                                                        <li>
                                                            <a href="javascript:void(0)">Hommes(18)</a>
                                                            <a href="javascript:void(0)">Femmes(18)</a>
                                                        </li>
                                                    </ul>
                                                    <a href="javascript:void(0)"
                                                        class="text-capitalize font-weight-bold">Colliers (18)</a>
                                                    <ul class="module-sub-list_item">
                                                        <li>
                                                            <a href="javascript:void(0)">Hommes(18)</a>
                                                            <a href="javascript:void(0)">Femmes(18)</a>
                                                        </li>
                                                    </ul>
                                                    <a href="javascript:void(0)"
                                                        class="text-capitalize font-weight-bold">Bracelés (18)</a>
                                                    <ul class="module-sub-list_item">
                                                        <li>
                                                            <a href="javascript:void(0)">Hommes(18)</a>
                                                            <a href="javascript:void(0)">Femmes(18)</a>
                                                        </li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </li>

                                        <li>
                                            <a href="javascript:void(0)" class="text-uppercase font-weight-bold">BASICS
                                                (300)</a>
                                            <ul class="module-sub-list_item">
                                                <li>
                                                    <a href="javascript:void(0)"
                                                        class="text-capitalize font-weight-bold">Bagues (18)</a>
                                                    <ul class="module-sub-list_item">
                                                        <li>
                                                            <a href="javascript:void(0)">Hommes(18)</a>
                                                            <a href="javascript:void(0)">Femmes(18)</a>
                                                        </li>
                                                    </ul>
                                                    <a href="javascript:void(0)"
                                                        class="text-capitalize font-weight-bold">Colliers (18)</a>
                                                    <ul class="module-sub-list_item">
                                                        <li>
                                                            <a href="javascript:void(0)">Hommes(18)</a>
                                                            <a href="javascript:void(0)">Femmes(18)</a>
                                                        </li>
                                                    </ul>
                                                    <a href="javascript:void(0)"
                                                        class="text-capitalize font-weight-bold">Bracelés (18)</a>
                                                    <ul class="module-sub-list_item">
                                                        <li>
                                                            <a href="javascript:void(0)">Hommes(18)</a>
                                                            <a href="javascript:void(0)">Femmes(18)</a>
                                                        </li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </li>

                                        <li>
                                            <a href="javascript:void(0)" class="text-uppercase font-weight-bold">SFIFA
                                                (250)</a>
                                            <ul class="module-sub-list_item">
                                                <li>
                                                    <a href="javascript:void(0)"
                                                        class="text-capitalize font-weight-bold">Bagues (18)</a>
                                                    <ul class="module-sub-list_item">
                                                        <li>
                                                            <a href="javascript:void(0)">Hommes(18)</a>
                                                            <a href="javascript:void(0)">Femmes(18)</a>
                                                        </li>
                                                    </ul>
                                                    <a href="javascript:void(0)"
                                                        class="text-capitalize font-weight-bold">Colliers (18)</a>
                                                    <ul class="module-sub-list_item">
                                                        <li>
                                                            <a href="javascript:void(0)">Hommes(18)</a>
                                                            <a href="javascript:void(0)">Femmes(18)</a>
                                                        </li>
                                                    </ul>
                                                    <a href="javascript:void(0)"
                                                        class="text-capitalize font-weight-bold">Bracelés (18)</a>
                                                    <ul class="module-sub-list_item">
                                                        <li>
                                                            <a href="javascript:void(0)">Hommes(18)</a>
                                                            <a href="javascript:void(0)">Femmes(18)</a>
                                                        </li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </li>

                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="col-lg-9 order-lg-1 order-1">
                    <div class="blog-item">
                        <div class="blog-img img-hover_effect">
                            @if ($blog->media->label == 'image')
                                <a href="blog-details-right-sidebar.html">
                                    <img src="{{ asset($blog->path) }}" alt="{{ $blog->title }}">
                                </a>
                            @else
                            <div class="embed-responsive embed-responsive-16by9">
                                <iframe src="{{ asset($blog->path) }}" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                            @endif
                            {{-- <a href="blog-details-left-sidebar.html">
                                <img src="{{ asset('front/assets/images/blog/1.jpg') }}"
                                    alt="Hiraola's Blog Image">
                                <img src="{{ asset($blog->path) }}" alt="{{ $blog->title }}">
                            </a> --}}
                            <div class="blog-meta-2">
                                <div class="blog-time_schedule">
                                    <span class="day">{{ $blog->created_at->format('d') }}</span>
                                    <span class="month">{{ $blog->created_at->format('F') }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="blog-content">
                            <div class="blog-heading">
                                <h5>
                                    <a href="javascrip:void(0)">{{ $blog->title }}</a>
                                </h5>
                            </div>
                            <div class="blog-short_desc">
                                <p> {{ $blog->description1 }} </p>
                            </div>
                        </div>
                        @if ($blog->note)
                            <div class="hiraola-blog-blockquote">
                                <blockquote>
                                    <p> {{ $blog->note }} </p>
                                </blockquote>
                            </div>
                        @endif
                        @if ($blog->description2)
                            <div class="blog-additional_information">
                                <p> {{ $blog->description2 }} </p>
                            </div>
                        @endif

                        <x-front.media></x-front.media>

                        @if ($blog->comments)
                            <div class="hiraola-comment-section">
                                <h3> <span id="commentsCount">{{ count($blog->comments) }}</span> comments</h3>
                                <ul id="commentContent">
                                    @foreach ($blog->comments as $comment)
                                        <li>
                                            <div class="author-avatar">
                                                <img src="{{ asset('front/assets/images/blog/user.png') }}" alt="User">
                                            </div>
                                            <div class="comment-body">
                                                <h5 class="comment-author">{{ $comment->user_name }}</h5>
                                                <div class="comment-post-date">
                                                    {{ $comment->created_at->format('d F, Y, H:i a') }}

                                                </div>
                                                <p> {{ $comment->description }} </p>
                                            </div>
                                        </li>
                                    @endforeach


                                </ul>
                            </div>
                        @endif

                        <div class="hiraola-blog-comment-wrapper">
                            <h3>leave a reply</h3>
                            <p>Your email address will not be published. Required fields are marked *</p>
                            <form action="javascript:void(0)">
                                <div class="comment-post-box">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <label>comment</label>
                                            <textarea id="comment" name="comment" placeholder="Write a comment"></textarea>
                                        </div>
                                        <div class="col-lg-4 col-md-4">
                                            <label for="user_name">Name</label>
                                            <input type="text" id="user_name" name="user_name" class="coment-field"
                                                placeholder="Name">
                                        </div>
                                        <div class="col-lg-4 col-md-4">
                                            <label for="user_email">Email</label>
                                            <input type="email" id="user_email" name="user_email" class="coment-field"
                                                placeholder="Email">
                                        </div>
                                        <div class="col-lg-12 mt-3">
                                            <div style="display: none" class="alert alert-danger errorsMessage"
                                                role="alert"></div>
                                            <div class="comment-btn_wrap f-left">
                                                <div class="hiraola-post-btn_area">
                                                    <a onclick="addComment({{ $blog->id }})" class="hiraola-post_btn"
                                                        href="javascript:void(0)">Post comment</a>
                                                </div>
                                                <!-- <input class="hiraola-post_btn" type="submit" name="submit" value="post comment"> -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--Blog Details Right Sidebar Area End Here -->
@endsection
@section('js')
    <script>
        function addComment(blog_id) {
            var comment = $('#comment').val();
            var user_name = $('#user_name').val();
            var user_email = $('#user_email').val();
            console.log(blog_id, comment, user_email, user_name);
            // if (comment && user_name && user_email) {
            $.ajax({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                },
                type: 'POST',
                url: "{{ url('comments') }}",
                data: {
                    blog_id: blog_id,
                    comment: comment,
                    user_name: user_name,
                    user_email: user_email
                },
                success: function(data) {
                    console.log(data);
                    var commentsCount = parseInt($.trim($('#commentsCount').text()));
                    var longDateFormat = 'd MMMM, yyyy, HH:mm a';
                    var date_comment = jQuery.format.date(data.created_at, longDateFormat)
                    var commentContent = '';
                    commentContent = `
                                <li>
                                    <div class="author-avatar">
                                        <img src="{{ asset('front/assets/images/blog/user.png') }}" alt="User">
                                    </div>
                                    <div class="comment-body">
                                        <h5 class="comment-author">` + data.user_name + `</h5>
                                        <div class="comment-post-date">
                                            ` + date_comment + `
                                        </div>
                                        <p> ` + data.description + ` </p>
                                    </div>
                                </li>
                                                       
                                                        `;
                    $('#commentContent').append(commentContent);
                    $('#commentsCount').text(commentsCount + 1);
                    $('#comment').val('');
                    $('#user_name').val('');
                    $('#user_email').val('');
                    Swal.fire({
                        // position: 'top-end',
                        icon: 'success',
                        title: 'Your comment has been saved',
                        showConfirmButton: false,
                        timer: 1500
                    })
                },
                error: function(data) {
                    console.log(data.responseJSON.errors)
                    $('.errorsMessage').empty();
                    $.each(data.responseJSON.errors, function(key, value) {
                        console.log(key + ": " + value);
                        $('<span>' + value + '</span> <br>').appendTo('.errorsMessage');
                    });
                    $('.errorsMessage').show();
                }
            });
            //}
        };

    </script>
    <script src="{{ asset('front/assets/js/sweetalert2.js') }}"></script>
    <script src="{{ asset('front/assets/js/jquery-dateFormat.js') }}"></script>

@endsection
